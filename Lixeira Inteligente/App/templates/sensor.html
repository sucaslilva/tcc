<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sensores</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://getbootstrap.com/docs/5.3/assets/css/docs.css"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      async function getData() {
        try {
          const response = await fetch("/sensores"); // Substitua '/endpoint' pelo seu endpoint

          if (!response.ok) {
            throw new Error(
              "Network response was not ok " + response.statusText
            );
          }

          const data = await response.json();
          populateTable(data); // Chama a função para popular a tabela com os dados
        } catch (error) {
          console.error("Houve um problema com a operação fetch:", error);
        }
      }

      function populateTable(users) {
        const tableBody = document.getElementById("userTableBody");
        tableBody.innerHTML = ""; // Limpa o conteúdo existente

        users.forEach((user, index) => {
          const row = tableBody.insertRow();

          const cod = row.insertCell(0);
          const descricao = row.insertCell(1);
          const ip = row.insertCell(2);
          const altura = row.insertCell(3);
          cod.textContent = user.codsensor; // ID começa em 1
          descricao.textContent = user.descricao; // Ajuste os nomes das propriedades conforme seu JSON
          ip.textContent = user.ip; // Ajuste os nomes das propriedades conforme seu JSON
          altura.textContent = user.altura; // Ajuste os nomes das propriedades conforme seu JSON
        });
      }

      // Chama a função getData quando a página é carregada
      window.onload = getData;

      async function cadastrarSensor(event) {
        event.preventDefault();
        const form = document.getElementById("cadastroForm");
        const formData = new FormData(form);
        const data = {
          descricao: formData.get("descricao"),
          ip: formData.get("ip"),
          altura: formData.get("altura"),
        };

        const response = await fetch("/cadastrarSensor", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify(data),
        });

        const result = await response.json();
        if (response.ok) {
          window.location.href = "/sensor";
        } else {
          alert("Erro: " + result.mensagem);
        }
      }

      async function excluirSensor(event) {
        event.preventDefault();
        const form = document.getElementById("cadastroForm2");
        const formData = new FormData(form);
        const codsensor = formData.get("codsensor");

        const response = await fetch("/sensor/" + codsensor, {
          method: "DELETE",
          headers: {
            "Content-Type": "application/json",
          },
        });

        const result = await response.json();
        if (response.ok) {
          window.location.href = "/sensor";
        } else {
          alert("Erro: " + result.mensagem);
        }
      }
    </script>
  </head>

  <body style="height: 100vh; background: #e7e7e7">
    <nav class="navbar navbar-expand-lg" style="background-color: #03366a">
      <div class="container-fluid">
        <a class="navbar-brand" href="#"
          ><img
            src="{{ url_for('static', filename='image/logo-brancol.png') }}"
            alt="Logo"
            width="125"
            height="35"
            class="d-inline-block align-text-top"
        /></a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
          aria-controls="navbarNav"
          aria-expanded="true"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav">
            <li class="nav-item">
              <a
                class="nav-link active"
                aria-current="page"
                href="/home"
                style="color: white"
                >Home</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/user" style="color: white">Usuários</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/sensor" style="color: white"
                >Sensores</a
              >
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/dashboard" style="color: white">Dashboard</a>
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <div class="geral" style="margin: 20px">
      <div class="table-responsive">
        <table class="table table-striped caption-top table-borderless">
          <caption>
            Lista de Usuários
          </caption>
          <thead>
            <tr>
              <th scope="col">Cód. Sensor</th>
              <th scope="col">Descrição</th>
              <th scope="col">IP</th>
              <th scope="col">Altura da Lixeira</th>
            </tr>
          </thead>
          <tbody class="table-group-divider" id="userTableBody">
            <!-- Dados serão inseridos aqui -->
          </tbody>
        </table>
      </div>
      <button
        class="btn"
        type="button"
        data-bs-toggle="offcanvas"
        data-bs-target="#staticBackdrop"
        aria-controls="staticBackdrop"
        style="background-color: #1bb89c; color: white"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          fill="currentColor"
          class="bi bi-plus-lg"
          viewBox="0 0 16 16"
        >
          <path
            fill-rule="evenodd"
            d="M8 2a.5.5 0 0 1 .5.5v5h5a.5.5 0 0 1 0 1h-5v5a.5.5 0 0 1-1 0v-5h-5a.5.5 0 0 1 0-1h5v-5A.5.5 0 0 1 8 2"
          />
        </svg>
      </button>
      <button
        class="btn"
        type="button"
        data-bs-toggle="offcanvas"
        data-bs-target="#staticBackdropDelete"
        aria-controls="staticBackdrop"
        style="background-color: #dc3545; color: white"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="16"
          height="16"
          fill="currentColor"
          class="bi bi-x-lg"
          viewBox="0 0 16 16"
        >
          <path
            d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z"
          />
        </svg>
      </button>
      <div
        class="offcanvas offcanvas-start"
        data-bs-backdrop="static"
        tabindex="-1"
        id="staticBackdrop"
        aria-labelledby="staticBackdropLabel"
      >
        <div class="offcanvas-header">
          <h5 class="offcanvas-title" id="staticBackdropLabel">
            Cadastrar Sensor
          </h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="offcanvas"
            aria-label="Close"
          ></button>
        </div>
        <div class="offcanvas-body">
          <div>
            <form id="cadastroForm" onsubmit="cadastrarSensor(event)">
              <div class="mb-3">
                <label for="descricao" class="form-label">Descrição</label>
                <input
                  type="text"
                  name="descricao"
                  class="form-control"
                  required
                />
              </div>
              <div class="mb-3">
                <label for="ip" class="form-label">IP</label>
                <input type="text" name="ip" class="form-control" required />
              </div>
              <div class="mb-3">
                <label for="altura" class="form-label">Altura da Lixeira</label>
                <input
                  type="number"
                  name="altura"
                  class="form-control"
                  required
                />
              </div>
              <div class="d-grid gap-2">
                <button
                  type="submit"
                  class="btn"
                  style="background-color: #1bb89c; color: white"
                >
                  Cadastrar
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div
        class="offcanvas offcanvas-start"
        data-bs-backdrop="static"
        tabindex="-1"
        id="staticBackdropDelete"
        aria-labelledby="staticBackdropLabel"
      >
        <div class="offcanvas-header">
          <h5 class="offcanvas-title" id="staticBackdropLabel">
            Excluir Sensor
          </h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="offcanvas"
            aria-label="Close"
          ></button>
        </div>
        <div class="offcanvas-body">
          <div>
            <form id="cadastroForm2" onsubmit="excluirSensor(event)">
              <div class="mb-3">
                <label for="codsensor" class="form-label">Cód. Sensor</label>
                <input
                  type="number"
                  name="codsensor"
                  class="form-control"
                  required
                />
              </div>
              <div class="d-grid gap-2">
                <button
                  type="submit"
                  class="btn"
                  style="background-color: #dc3545; color: white"
                >
                  Excluir
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
